{"version":3,"sources":["webpack:///./static/js/src/timeline/timeline.js"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,0BAAyB,EAAE,eAAe,EAAE,EAAE,EAAE,EAAE,EAAE;AACpD,6BAA4B;AAC5B,MAAK;;AAEL;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,wBAAuB,WAAW;AAClC;AACA;AACA;AACA;AACA;AACA;AACA,aAAY;AACZ,6CAA4C,aAAa;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW;AACX;AACA;AACA;AACA;AACA;AACA,YAAW;;AAEX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAkB,WAAW;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA,eAAc;AACd,+CAA8C,aAAa;AAC3D;AACA;AACA,a;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAe,WAAW;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAe;AACf,gDAA+C,aAAa;AAC5D;AACA;AACA,e;AACA;AACA;;AAEA;;AAEA;;AAEA,OAAM;AACN;AACA;AACA;AACA,GAAE;;AAEF,EAAC,E","file":"timeline.js","sourcesContent":["var util = require(\"util\");\r\nvar layerGroup;\r\nvar points = [];\r\nvar map;\r\n\r\nvar types = 10;\r\n\r\n$(document).ready(function(){\r\n\tmap = L.map('timeline-map').setView([28.38, 121.21], 8);\r\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\r\n        attribution: '&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\r\n    }).addTo(map);\r\n\r\n\t$.ajax({\r\n\t    type: \"GET\",\r\n\t    url: util.urlBase + '/search',\r\n\t    data: {},\r\n\t    success: function(data){\r\n\t    \tconsole.log(data);\r\n\t\t    var twopoint = [];\r\n\t\t    var len = data[0].records.coordinates.length;\r\n\t        layerGroup && layerGroup.clearLayers();\r\n    \t\tlayerGroup = L.layerGroup();\r\n\t        for(var i = 0; i < len-1; i++)\r\n\t        {\r\n\t          twopoint[0]= L.latLng(data[0].records.coordinates[i][0],data[0].records.coordinates[i][1]);\r\n\t          twopoint[1]= L.latLng(data[0].records.coordinates[i+1][0],data[0].records.coordinates[i+1][1]);\r\n\t          if(data[0].records.coordinates[i][3] != 0 && data[0].records.coordinates[i+1][3] != 0){\r\n\t          \tvar temp = L.circle(twopoint[0], 200);\r\n\t          \tlayerGroup.addLayer(temp);\r\n\t          }else{\r\n\t          \tvar temp = L.polyline(twopoint,{color: 'red'});\r\n\t          \tlayerGroup.addLayer(temp);\r\n\t          }\r\n\t          var temp = {\r\n\t            index: i,\r\n\t            radius: 20,\r\n\t            lat: data[0].records.coordinates[i][0],\r\n\t            lng: data[0].records.coordinates[i][1],\r\n\t            time: data[0].records.coordinates[i][2]\r\n\t\t      };\r\n\t\t      points.push(temp);\r\n\t        }\r\n\t        layerGroup.addTo(map);\r\n\t        var temp = {\r\n\t            index: len,\r\n\t            radius: 2,\r\n\t            lat: data[0].records.coordinates[len-1][0],\r\n\t            lng: data[0].records.coordinates[len-1][1],\r\n\t            time: data[0].records.coordinates[len-1][2]\r\n\t\t      };\r\n\t\t    points.push(temp);\r\n\r\n\t\t    // Brush\r\n\t\t    var canvas = d3.select(\"#timeline-timeline svg\").append(\"g\");\r\n\t\t    var width = $(\"#timeline-timeline svg\").width();\r\n\t\t    var height = $(\"#timeline-timeline svg\").height();\r\n\t\t    var timeExtent = d3.extent(points, function(d) {\r\n\t\t        return new Date(d.time);\r\n\t\t    });\r\n\t\t    var x = d3.time.scale()\r\n\t\t        .range([0, width])\r\n\t\t        .domain(timeExtent);\r\n\t\t    var y = d3.scale.linear()\r\n\t\t\t\t.range([height, 0]);\r\n\t\t    var xAxis = d3.svg.axis()\r\n\t\t\t\t.scale(x)\r\n\t\t\t\t.orient(\"bottom\")\r\n\t\t\t\t.ticks(6);\r\n\t\t\tvar yAxis = d3.svg.axis()\r\n\t\t\t\t.scale(y)\r\n\t\t\t\t.orient(\"left\");\r\n\t\t\t//X 轴\r\n\t\t\td3.select(\"#timeline-timeline svg\").append(\"g\")\r\n\t\t\t\t.attr(\"class\", \"axis\")\r\n\t\t\t\t.attr(\"transform\", \"translate(0,\" + (height-30) + \")\")\r\n\t\t\t\t.call(xAxis)\r\n\t\t\t.append(\"text\")\r\n\t\t\t\t.attr(\"class\", \"label\")\r\n\t\t\t\t.attr(\"x\", width)\r\n\t\t\t\t.attr(\"y\", -6)\r\n\t\t\t\t.style(\"text-anchor\", \"end\")\r\n\t\t\t\t.text(\"Date\");\r\n\t\t\t//Y 轴\r\n\t\t\td3.select(\"#timeline-timeline svg\").append(\"g\")\r\n\t\t\t\t.attr(\"class\", \"axis\")\r\n\t\t\t\t.attr(\"transform\", \"translate(0,\" + \"0)\")\r\n\t\t\t\t.call(yAxis)\r\n\t\t\t.append(\"text\")\r\n\t\t\t\t.attr(\"transform\", \"rotate(-90)\")\r\n\t\t\t\t.attr(\"y\", 6)\r\n\t\t\t\t.attr(\"dy\", \".71em\")\r\n\t\t\t\t.style(\"text-anchor\", \"end\")\r\n\t\t\t\t.text(\"v,s\");\r\n\r\n\t\t    canvas.selectAll(\".point\")\r\n\t\t        .data(points)\r\n\t\t        .enter()\r\n\t\t        .append(\"circle\")\r\n\t\t        .attr(\"class\", 'point')\r\n\t\t        .attr(\"r\", function(d){\r\n\t\t            return d.radius;\r\n\t\t        })\r\n\t\t        .attr(\"fill\", \"red\")\r\n\t\t        .attr(\"opacity\", 0.3)\r\n\t\t        // .attr(\"stroke\", 'black')\r\n\t\t        .attr(\"transform\", function(d){\r\n\t\t            return \"translate(\" + x(new Date(d.time)) + ', ' + height/2 + ')';\r\n\t\t        });\r\n\r\n\t\t    var brush = d3.svg.brush()\r\n\t\t        .x(x)\r\n\t\t        .on('brushend', brushend);\r\n\t\t    canvas.append('g')\r\n\t\t        .attr('class', 'x brush')\r\n\t\t        .call(brush)\r\n\t\t        .selectAll('rect')\r\n\t\t        .attr('y', -6)\r\n\t\t        .attr('height', height);\r\n\t\t    // Moving Date\r\n\t\t    canvas.append(\"text\")\r\n\t\t    \t.attr(\"class\", \"left_label\")\r\n\t\t\t\t.attr(\"x\", -100)\r\n\t\t\t\t.attr(\"y\", height/5)\r\n\t\t\t\t.text(\" \");\r\n\t\t\tcanvas.append(\"text\")\r\n\t\t    \t.attr(\"class\", \"right_label\")\r\n\t\t\t\t.attr(\"x\", -100)\r\n\t\t\t\t.attr(\"y\", height/5*4)\r\n\t\t\t\t.text(\" \");\r\n\r\n\t\t    function brushend() {\r\n\t\t    \tlayerGroup && layerGroup.clearLayers();\r\n\t\t\t    layerGroup = L.layerGroup();\r\n\t\t    \tvar l = brush.extent()[0];\r\n\t\t    \tvar r = brush.extent()[1];\r\n\t\t    \tif (brush.empty())\r\n\t\t    \t{\r\n\t\t    \t\td3.select(\".left_label\")\r\n\t\t    \t\t\t.attr(\"x\", -100);\r\n\t\t    \t\td3.select(\".right_label\")\r\n\t\t    \t\t\t.attr(\"x\", -100);\r\n\t\t    \t\tfor(i = 0; i < len-1; i++)\r\n\t\t\t        {\r\n\t\t          \t  twopoint[0]= L.latLng(data[0].records.coordinates[i][0],data[0].records.coordinates[i][1]);\r\n\t\t\t          twopoint[1]= L.latLng(data[0].records.coordinates[i+1][0],data[0].records.coordinates[i+1][1]);\r\n\t\t\t          if(data[0].records.coordinates[i][3] != 0 && data[0].records.coordinates[i+1][3] != 0){\r\n\t\t\t          \tvar temp = L.circle(twopoint[0], 200);\r\n\t\t\t          \tlayerGroup.addLayer(temp);\r\n\t\t\t          }else{\r\n\t\t\t          \tvar temp = L.polyline(twopoint,{color: 'red'});\r\n\t\t\t          \tlayerGroup.addLayer(temp);\r\n\t\t\t          }\r\n\t\t\t        } \r\n\t\t    \t}\r\n\t\t    \telse \r\n\t\t    \t{\r\n\t\t    \t\td3.select(\".left_label\")\r\n\t\t    \t\t\t.attr(\"x\", x(l))\r\n\t\t    \t\t\t.text(l);\r\n\t\t    \t\td3.select(\".right_label\")\r\n\t\t    \t\t\t.attr(\"x\", x(r))\r\n\t\t    \t\t\t.text(r);\r\n\t\t\t\t\tfor(i = 0; i < len-1; i++)\r\n\t\t\t        {\r\n\t\t\t          var time = new Date(data[0].records.coordinates[i][2]);\r\n\t\t\t          if (time >= l && time <= r)\r\n\t\t\t          {\r\n\t\t\t          \t  twopoint[0]= L.latLng(data[0].records.coordinates[i][0],data[0].records.coordinates[i][1]);\r\n\t\t\t\t          twopoint[1]= L.latLng(data[0].records.coordinates[i+1][0],data[0].records.coordinates[i+1][1]);\r\n\t\t\t\t          if(data[0].records.coordinates[i][3] != 0 && data[0].records.coordinates[i+1][3] != 0){\r\n\t\t\t\t          \tvar temp = L.circle(twopoint[0], 200);\r\n\t\t\t\t          \tlayerGroup.addLayer(temp);\r\n\t\t\t\t          }else{\r\n\t\t\t\t          \tvar temp = L.polyline(twopoint,{color: 'red'});\r\n\t\t\t\t          \tlayerGroup.addLayer(temp);\r\n\t\t\t\t          }\r\n\t\t\t          } \r\n\t\t\t\t    }\r\n\t\t\t\t}\r\n\r\n\t\t\t    layerGroup.addTo(map);\r\n\r\n\t\t\t}\r\n\r\n\t    },\r\n\t    error: function(data){\r\n\t        console.log(data);\r\n\t    }\r\n\t});\r\n    \r\n});\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./static/js/src/timeline/timeline.js\n ** module id = 0\n ** module chunks = 2\n **/"],"sourceRoot":""}
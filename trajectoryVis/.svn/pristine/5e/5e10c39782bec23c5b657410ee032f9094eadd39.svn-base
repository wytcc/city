{"version":3,"sources":["webpack:///./static/js/src/earthquake/earthquake.js"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,MAAK;AACL;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA,UAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,0BAAyB,EAAE,eAAe,EAAE,EAAE,EAAE,EAAE,EAAE;AACpD,6BAA4B;AAC5B,MAAK;;AAEL;AACA;AACA;AACA;AACA,2BAA0B,iBAAiB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA,MAAK;;AAEL,mBAAkB,WAAW;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL,EAAC,E","file":"earthquake.js","sourcesContent":["/**\n * Created by huwanqi on 2016/3/13.\n */\nvar util = require(\"util\");\nvar layerGroup;\nvar points = [];\nvar selectedPoints = [];\nvar map;\nvar types = 10;\nvar selectedType = [];\nvar time_min = null;\nvar time_max = null;\n\nvar colors = [];\n\nvar filterPoints = function(){\n    var temps = [];\n    if(time_min && time_max){\n        points.forEach(function(p){\n            var time = new Date(p.time);\n            if(time > time_min && time < time_max && selectedType[p.type]){\n                temps.push(p);\n            }\n        });\n    }else{\n        points.forEach(function(p){\n            if(selectedType[p.type]){\n                temps.push(p);\n            }\n        });\n    }\n    selectedPoints = temps;\n};\n\nvar drawPoints = function(){\n    layerGroup && layerGroup.clearLayers();\n    layerGroup = L.layerGroup();\n    selectedPoints.forEach(function(p){\n        var circle = L.circle([p.lat, p.lng], 1000, {\n            color: colors[p.type],\n            fillColor: colors[p.type]\n        }).addTo(layerGroup);\n        circle.p = p;\n    });\n    layerGroup.addTo(map);\n};\n\nvar drawSVGPoints = function(){\n    var canvas = d3.select(\"#earthquake-timeline svg g\");\n    canvas.selectAll(\"*\").remove();\n    d3.selectAll(\".axis\").remove();\n    var width = $(\"#earthquake-timeline svg\").width();\n    var height = $(\"#earthquake-timeline svg\").height();\n    var timeExtent = d3.extent(selectedPoints, function(d) {\n        return new Date(d.time);\n    });\n    var x = d3.time.scale()\n        .range([0, width])\n        .domain(timeExtent);\n    var y = d3.scale.linear()\n        .range([height, 0]);\n    var xAxis = d3.svg.axis()\n        .scale(x)\n        .orient(\"bottom\")\n        .ticks(6);\n    var yAxis = d3.svg.axis()\n        .scale(y)\n        .orient(\"left\");\n    //X 轴\n    d3.select(\"#earthquake-timeline svg\").append(\"g\")\n        .attr(\"class\", \"axis\")\n        .attr(\"transform\", \"translate(0,\" + (height-30) + \")\")\n        .call(xAxis)\n        .append(\"text\")\n        .attr(\"class\", \"label\")\n        .attr(\"x\", width)\n        .attr(\"y\", -6)\n        .style(\"text-anchor\", \"end\")\n        .text(\"Date\");\n    //Y 轴\n    d3.select(\"#earthquake-timeline svg\").append(\"g\")\n        .attr(\"class\", \"axis\")\n        .attr(\"transform\", \"translate(0,\" + \"0)\")\n        .call(yAxis)\n        .append(\"text\")\n        .attr(\"transform\", \"rotate(-90)\")\n        .attr(\"y\", 6)\n        .attr(\"dy\", \".71em\")\n        .style(\"text-anchor\", \"end\")\n        .text(\"v,s\");\n\n    canvas.selectAll(\".point\")\n        .data(selectedPoints)\n        .enter()\n        .append(\"circle\")\n        .attr(\"class\", 'point')\n        .attr(\"r\", 2)\n        .attr(\"fill\", function(d){\n            return colors[d.type];\n        })\n        .attr(\"opacity\", 0.3)\n        // .attr(\"stroke\", 'black')\n        .attr(\"transform\", function(d){\n            return \"translate(\" + x(new Date(d.time)) + ', ' + height/2 + ')';\n        });\n\n    var brush = d3.svg.brush()\n        .x(x)\n        .on('brushend', brushend)\n        .on('brushstart', brushstart);\n    canvas.append('g')\n        .attr('class', 'x brush')\n        .call(brush)\n        .selectAll('rect')\n        .attr('y', -6)\n        .attr('height', height);\n    //// Moving Date\n    canvas.append(\"text\")\n        .attr(\"class\", \"time_label left_label\")\n        .attr(\"x\", -100)\n        .attr(\"y\", height/5)\n        .text(\" \");\n    canvas.append(\"text\")\n        .attr(\"class\", \"time_label right_label\")\n        .attr(\"x\", -100)\n        .attr(\"y\", height/5*4)\n        .text(\" \");\n\n    function brushstart() {\n        $(\".time_label\").hide();\n        time_min = null;\n        time_max = null;\n    }\n    function brushend() {\n        if (brush.empty()) {\n            $(\".time_label\").hide();\n            filterPoints();\n            drawPoints();\n        } else {\n            time_min = brush.extent()[0];\n            time_max = brush.extent()[1];\n            $(\".time_label\").show();\n            d3.select(\".left_label\")\n                .attr(\"x\", x(time_min))\n                .text(time_min);\n            d3.select(\".right_label\")\n                .attr(\"x\", x(time_max))\n                .text(time_max);\n            filterPoints();\n            drawPoints();\n        }\n    }\n};\n\n$(document).ready(function(){\n    //开始默认所有类别都勾上\n    map = L.map('earthquake-map').setView([28.38, 121.21], 8);\n    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {\n        attribution: '&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n    }).addTo(map);\n\n    $.ajax({\n        type: 'GET',\n        url: util.urlBase + '/search3',\n        success: function(data){\n            for(var i = 0; i < data.length; i++)\n            {\n                var coordinates = data[i].coordinates;\n                var p = {\n                    lat: coordinates[0],\n                    lng: coordinates[1],\n                    time: coordinates[2],\n                    type: data[i].cindex\n                };\n                points.push(p);\n            }\n            selectedPoints = points;\n            drawPoints();\n            drawSVGPoints();\n        },\n        error: function(data){\n            console.log(data);\n        }\n    });\n\n    for(var i = 0; i < types; i++){\n        selectedType[i] = true;\n        colors[i] = '#'+('00000'+(Math.random()*0x1000000<<0).toString(16)).slice(-6);\n        $(\".earthquake-types\").append('<div class=\"item\" data=\"' + i + '\" style=\"color: ' + colors[i] + '\"> ' +\n            '<input type=\"checkbox\" name=\"type\" id=\"types-' + i + '\" checked/> ' +\n            '<label for=\"types-' + i + '\">第' + i + '类</label> ' +\n            '</div>');\n    }\n\n    $(\"body\").on(\"change\", \".earthquake-types .item input\", function(){\n        var checked = $(this)[0].checked;\n        var type = $(this).parents(\".item\").attr(\"data\");\n        selectedType[type] = checked;\n        filterPoints();\n        drawPoints();\n        drawSVGPoints();\n    });\n\n});\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./static/js/src/earthquake/earthquake.js\n ** module id = 0\n ** module chunks = 0\n **/"],"sourceRoot":""}